<main>
  <div class="container" id="inner_container">
    <form (ngSubmit)="submit()" #ticketForm="ngForm" class="form-class">
      <div class="heading">
        <h3 class="classic_heading">Ajourte une ticket</h3>
      </div>
      <div class="form-group mb-3">
        <label for="title" class="mb-2">Ticket titre</label>
        <input 
          type="text" 
          id="title" 
          name="title" 
          class="form-control" 
          placeholder="title" 
          [(ngModel)]="title"
          required
        />
        <small class="form-text text-muted">Ajoutez le titre du ticket</small>
      </div>

      <div class="form-group mb-3">
        <label for="description" class="form-label">Description</label>
        <textarea
          id="description"
          name="description"
          rows="4"
          class="form-control"
          [(ngModel)]="description"
          required
        ></textarea>
        <small class="form-text text-muted">Composez votre ticket</small>
      </div>
      <div>
        <ul class="list-unstyled mb-3" *ngIf="filePreviews.length > 0">
          <li *ngFor="let preview of filePreviews; let i = index" class="d-flex align-items-center gap-3 mb-2 border rounded p-2">
            <ng-container *ngIf="preview.file.type.startsWith('image/'); else nonImage">
              <img [src]="preview.url" alt="Preview" width="60" height="60" style="object-fit: cover; border-radius: 4px;" />
            </ng-container>
            <ng-template #nonImage>
              <div class="d-flex flex-column">
                <strong>{{ preview.file.name }}</strong>
                <small>{{ preview.file.type || 'Unknown Type' }}</small>
              </div>
            </ng-template>
            <button type="button" class="btn btn-sm btn-danger ms-auto" (click)="removeFile(i)">Supprimer</button>
          </li>
        </ul>
        <input type="file" multiple (change)="onFileSelected($event)" style="display:none" #fileInput />
        <img 
          src="assets/attachment-interface.svg" 
          alt="Upload" 
          style="width: 40px; height: 40px; cursor: pointer"
          (click)="fileInput.click()"
        />
        <small class="mx-3">Ajoutez une peice joint</small>
      </div>
      <hr>
      <div class="d-flex justify-content-end mt-3">
        <button type="submit" class="classic_button" [disabled]="!ticketForm.form.valid">Envoyer
          <img src="assets/send-svg.svg" alt="link" class="classic_svg">
        </button>
      </div>
    </form>
    <div class="info">
      <p class="mx-a small">
        Veuillez noter que selon nos dernières analyses, nous répondons aux tickets le jour même 
        et cela peut prendre au maximum 1 à 2 jours ouvrables.</p>
    </div>
  </div>
</main>
